# extra-promise [![npm](https://img.shields.io/npm/v/extra-promise.svg?maxAge=2592000)](https://www.npmjs.com/package/extra-promise) [![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)](https://raw.githubusercontent.com/BlackGlory/extra-promise/master/LICENSE) [![Build Status](https://travis-ci.org/BlackGlory/extra-promise.svg?branch=master)](https://travis-ci.org/BlackGlory/extra-promise) [![Coverage Status](https://coveralls.io/repos/github/BlackGlory/extra-promise/badge.svg)](https://coveralls.io/github/BlackGlory/extra-promise)

Native Promise helpers for Vanilla JS

## Installation

```sh
yarn add extra-promise
```

```javascript
import * as extraPromise from 'extra-promise'
import { chain, delay, each, every, isPromise, map, promisify, retry, sleep, warn } from 'extra-promise'
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [chain](#chain)
-   [delay](#delay)
-   [eachDictionary](#eachdictionary)
-   [eachList](#eachlist)
-   [each](#each)
-   [everyDictionary](#everydictionary)
-   [everyList](#everylist)
-   [every](#every)
-   [isPromise](#ispromise)
-   [mapDictionary](#mapdictionary)
-   [mapList](#maplist)
-   [map](#map)
-   [promisify](#promisify)
-   [retry](#retry)
-   [sleep](#sleep)
-   [warn](#warn)

### chain

Make asynchronous chained calls easy to write.

**Parameters**

-   `target` **([Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function))** A target that requires asynchronous chained calls

**Examples**

```javascript
class Calculator {
  constructor(initialValue) {
    this.value = initialValue
  }

  async get() {
    return this.value
  }

  async add(value) {
    this.value += value
    return this
  }

  async sub(value) {
    this.value -= value
    return this
  }
}

;(async () => {
  // use chain()
  console.log(
    await chain(new Calculator(100))
      .add(50)
      .sub(100)
      .get()
  ) // 50

  // only use await
  console.log(
    await (
      await (
        await (
          new Calculator(100).add(50)
        )
      ).sub(100)
    ).get()
  ) // 50

  // only use then()
  new Calculator(100).add(50)
    .then(x => x.sub(100))
    .then(x => x.get())
    .then(console.log) // 50
})()
```

Returns **[Proxy](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Proxy)&lt;[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)>** A Proxy object that support asynchronous chained calls

### delay

Wrap an async function as a delayed async function.

**Parameters**

-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** async function
-   `timeout` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** delay(ms) (optional, default `0`)

**Examples**

```javascript
async function sayHello(name) {
  console.log(`${ name }: Hello.`)
}

const sayHelloAfterOneSecond = delay(sayHello, 1000)

;(async () => {
  await sayHelloAfterOneSecond('Jerry')

  // same as
  await sleep(1000)
  await sayHello('Jerry')
})()
```

Returns **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** new async function

### eachDictionary

The values of a dictionary are converted to asynchronous tasks by factory function, exceptions will be ignored.

**Parameters**

-   `dictionary` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** dictionary
-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** factory function
-   `concurrency` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of tasks processed at the same time, default is all at the same time (optional, default `Object.keys(dictionary).length`)

**Examples**

```javascript
const printDouble = async x => console.log(x * 2)
const dictionary = {
  a: 1
, b: 2
, c: 3
}

;(async () => {
  await eachDictionary(dictionary, printDouble) // 2 4 6
})()
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** Promise state changes to Resolved when all asynchronous tasks have completed

### eachList

The elements of a list are converted to asynchronous tasks by factory function, exceptions will be ignored.

**Parameters**

-   `list` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** list
-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** factory function
-   `concurrency` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of tasks processed at the same time, default is all at the same time (optional, default `list.length`)

**Examples**

```javascript
const printDouble = async x => console.log(x * 2)
const list = [1, 2, 3]

;(async () => {
  await eachList(list, printDouble) // 2 4 6
})()
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** Promise state changes to Resolved when all asynchronous tasks have completed

### each

Equivalent to eachList or eachDictionary.

**Parameters**

-   `listOrDictionary` **([Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array) \| [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object))** list or dictionary
-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** factory function
-   `concurrency` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of tasks processed at the same time, default is all at the same time


-   Throws **[TypeError](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/TypeError)** First argument must be a List or Dictionary

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** Promise state changes to Resolved when all asynchronous tasks have completed

### everyDictionary

The values of a dictionary are converted to asynchronous tasks and return results by factory function, exceptions will be abort all tasks.

**Parameters**

-   `dictionary` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** dictionary
-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** factory function
-   `concurrency` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of tasks processed at the same time, default is all at the same time (optional, default `Object.keys(dictionary).length`)

**Examples**

```javascript
const double = async x => x * 2
const dictionary = {
  a: 1
, b: 2
, c: 3
}

;(async () => {
  const newDictionary = await everyDictionary(dictionary, double)
  console.log(newDictionary)
  // { a: 2, b: 4, c: 6 }
})()
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)>** A dictionary with same keys

### everyList

The elements of a list are converted to asynchronous tasks and return results by factory function, exceptions will be abort all tasks.

**Parameters**

-   `list` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** list
-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** factory function
-   `concurrency` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of tasks processed at the same time, default is all at the same time (optional, default `list.length`)

**Examples**

```javascript
const double = async x => x * 2
const list = [1, 2, 3]

;(async () => {
  const newList = await everyList(list, double)
  console.log(newList)
  // [2, 4, 6]
})()
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)>** A list with same indexs

### every

Equivalent to everyList or everyDictionary.

**Parameters**

-   `listOrDictionary` **([Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array) \| [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object))** list or dictionary
-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** factory function
-   `concurrency` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of tasks processed at the same time, default is all at the same time


-   Throws **[TypeError](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/TypeError)** First argument must be a List or Dictionary

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;([Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array) \| [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object))>** A list or dictionary

### isPromise

Check if an object is a Promise instance.

**Parameters**

-   `obj` **any** An object to be checked

**Examples**

```javascript
isPromise(Promise.resolve()) // true
isPromise(Promise.reject()) // true
isPromise(Promise) // false
isPromise({ then() {} }) // true
```

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Result

### mapDictionary

The values of a dictionary are converted to asynchronous tasks and return results by factory function, exceptions will save as results.

**Parameters**

-   `dictionary` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** dictionary
-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** factory function
-   `concurrency` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of tasks processed at the same time, default is all at the same time (optional, default `Object.keys(dictionary).length`)

**Examples**

```javascript
async function oneHundredDividedBy(x) {
  if (x === 0) {
    throw new RangeError('Divisor cannot be 0')
  }
  return 100 / x
}

const dictionary = {
  a: 0
, b: 1
, c: 2
}

;(async () => {
  const newDictionary = await mapDictionary(dictionary, oneHundredDividedBy)
  console.log(newDictionary)
  // { a: RangeError('Divisor cannot be 0'), b: 100, c: 50 }
})()
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)>** A dictionary with same keys

### mapList

The elements of a list are converted to asynchronous tasks and return results by factory function, exceptions will save as results.

**Parameters**

-   `list` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** list
-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** factory function
-   `concurrency` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of tasks processed at the same time, default is all at the same time (optional, default `list.length`)

**Examples**

```javascript
async function oneHundredDividedBy(x) {
  if (x === 0) {
    throw new RangeError('Divisor cannot be 0')
  }
  return 100 / x
}

const list = [0, 1, 2]

;(async () => {
  const newList = await mapList(list, oneHundredDividedBy)
  console.log(newList)
  // [RangeError('Divisor cannot be 0'), 100, 50]
})()
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)>** A list with same indexs

### map

Equivalent to mapList or mapDictionary.

**Parameters**

-   `listOrDictionary` **([Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array) \| [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object))** list or dictionary
-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** factory function
-   `concurrency` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of tasks processed at the same time, default is all at the same time


-   Throws **[TypeError](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/TypeError)** First argument must be a List or Dictionary

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;([Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array) \| [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object))>** A list or dictionary

### promisify

Convert a function that use callback to async functions.

**Parameters**

-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** function

**Examples**

```javascript
const add = (a, b, callback) => callback(a + b)
const asyncAdd = promisify(add)
;(async () => {
  const result = await asyncAdd(1, 2) // 3
})()
```

Returns **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** async function

### retry

Wrap an async function as an async function that will retry when meet Rejected, and if it still fails after all retry, returns an array of all exceptions.

**Parameters**

-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** async function
-   `maxRetryCount` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The maximum number of retries, default is 1 (optional, default `1`)
-   `retryInterval` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Retry interval(ms), default is 0 (optional, default `0`)

**Examples**

```javascript
function threeOrOut() {
  let times = 0
  return async () => {
    times++
    if (times < 3) {
      throw new Error('need more')
    }
    return times
  }
}
const threeOrOutWithRetry = retry(threeOrOut(), 3)

;(async () => {
  const result = await threeOrOutWithRetry()
  console.log(result) // 3
})()
```

Returns **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** new async function

### sleep

A sleep async function.

**Parameters**

-   `timeout` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** = 0 sleep time(ms) (optional, default `0`)

**Examples**

```javascript
;(async () => {
  console.log('I will print something in 5s...')
  await sleep(5000) // sleep five seconds.
  console.log('something')
})()
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** Actual sleep time(ms)

### warn

Wrap an async function as an async function that will only invoke a warning function when Promise status is Rejected without interrupting the running.

**Parameters**

-   `fn` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** async function
-   `buzzer` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** Function to receive the warning (optional, default `console.warn||console.error||console.log`)

**Examples**

```javascript
const problemMaker = text => Promise.reject(text)
const buzzer = e => console.warn(`${ new Date() }: ${ e }`)
const problemMakerWithBuzzer = warn(problemMaker, buzzer)

;(async () => {
  await problemMakerWithBuzzer('Warning!')
})()
```

Returns **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** new async function
